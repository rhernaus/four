# Enable URL rewriting
RewriteEngine On

# Set the base
RewriteBase /

# Security Headers - Critical for XSS and other attack prevention
<IfModule mod_headers.c>
    # Prevent clickjacking attacks
    Header always set X-Frame-Options "DENY"

    # Prevent MIME type sniffing
    Header always set X-Content-Type-Options "nosniff"

    # Enable XSS protection (legacy browsers)
    Header always set X-XSS-Protection "1; mode=block"

    # Control referrer information
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # Prevent downloads of potentially dangerous files
    Header always set X-Download-Options "noopen"

    # Ensure HTTPS connections (when using HTTPS)
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains" env=HTTPS

    # Content Security Policy (backup to meta tag)
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline'; style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; font-src 'self' https://fonts.gstatic.com; connect-src 'self'; img-src 'self' data:; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none';"

    # Remove server signature
    Header unset Server
    Header unset X-Powered-By
</IfModule>

# Prevent access to sensitive files
<FilesMatch "\.(htaccess|htpasswd|ini|log|sh|inc|bak)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Ensure direct access to actual files still works
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Handle language-specific URLs in the format: /nl/programming
RewriteRule ^(nl|de|en)/([^/]+)$ index.html [L]

# Handle default language (English) URLs in the format: /programming
RewriteRule ^([^/]+)$ index.html [L]

# Prevent infinite loops (optional, but useful)
RewriteCond %{THE_REQUEST} /index\.html [NC]
RewriteRule ^index\.html$ / [R=301,L]